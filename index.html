<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Farm Animal Database</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { color: #4CAF50; }
  .section { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
  label { display: block; margin-top: 5px; }
  select, input, textarea { width: 100%; padding: 5px; margin-top: 3px; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
  button { margin-top: 5px; }
  .row { display: flex; gap: 5px; }
  .row > div { flex: 1; }
</style>
</head>
<body>
<h1>Farm Animal Database</h1>

<div class="section">
  <h2>Farm Info</h2>
  <label>Farm Name <input id="farmName"></label>
  <label>Address <input id="farmAddress"></label>
  <label>Phone <input id="farmPhone"></label>
  <button onclick="saveFarmInfo()">Save Farm Info</button>
</div>

<div class="section">
  <h2>Add/Edit Animal</h2>
  <label>Tag Number (max 4 chars, required) <input id="animalTag" maxlength="4" required></label>
  <label>Tattoo Number (max 4 chars) <input id="animalTattoo" maxlength="4"></label>

  <label>Breed</label>
  <div class="row">
    <div><select id="animalBreed"></select></div>
    <div><button onclick="manageDropdown('breed','animalBreed')">Edit Breeds</button></div>
  </div>

  <label>Type</label>
  <div class="row">
    <div><select id="animalType">
      <option>Cow</option>
      <option>Bull</option>
      <option>Heifer</option>
      <option>Steer</option>
    </select></div>
  </div>

  <label>Location <input id="animalLocation"></label>
  <label>Maternal Parent <input id="maternalParent"></label>
  <label>Paternal Parent <input id="paternalParent"></label>

  <label>Udder Suspension</label>
  <div class="row">
    <div><select id="udderSuspension"></select></div>
    <div><button onclick="manageDropdown('udderSuspension','udderSuspension')">Edit</button></div>
  </div>

  <label>Udder Size</label>
  <div class="row">
    <div><select id="udderSize"></select></div>
    <div><button onclick="manageDropdown('udderSize','udderSize')">Edit</button></div>
  </div>

  <label>Calving Ease</label>
  <div class="row">
    <div><select id="calvingEase"></select></div>
    <div><button onclick="manageDropdown('calvingEase','calvingEase')">Edit</button></div>
  </div>

  <label>Docility</label>
  <div class="row">
    <div><select id="docility"></select></div>
    <div><button onclick="manageDropdown('docility','docility')">Edit</button></div>
  </div>

  <h3>Medication</h3>
  <label>Date Administered <input type="date" id="medDate"></label>
  <label>Medication Type <input id="medType"></label>
  <label>Quantity <input id="medQty"></label>
  <label>Next Due Date <input type="date" id="medNext"></label>
  <button onclick="addMedication()">Add Medication Record</button>
  <ul id="medHistory"></ul>

  <button onclick="saveAnimal()">Save Animal</button>
</div>

<div class="section">
  <h2>Animals List</h2>
  <table id="animalsTable">
    <thead>
      <tr>
        <th>Tag</th><th>Tattoo</th><th>Breed</th><th>Type</th><th>Location</th>
        <th>Maternal</th><th>Paternal</th><th>Udder Sus</th><th>Udder Size</th>
        <th>Calving Ease</th><th>Docility</th><th>Medications</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="section">
  <h2>Import / Export</h2>
  <button onclick="exportData()">Export Data</button>
  <input type="file" id="importFile" onchange="importData(this)">
</div>

<script>
const defaultOptions = {
  breed: ['Gelbvieh','Balancer'],
  udderSuspension: ['1','2','3','4','5','6','7','8','9'],
  udderSize: ['1','2','3','4','5','6','7','8','9'],
  calvingEase: ['1','2','3','4','5'],
  docility: ['1','2','3','4','5']
};

let currentMedications = [];

// Dropdown functions
function loadDropdownOptions(key, selectId){
  let options = JSON.parse(localStorage.getItem('options_' + key) || 'null');
  if(!options){ options = defaultOptions[key]; localStorage.setItem('options_'+key, JSON.stringify(options)); }
  const sel = document.getElementById(selectId);
  sel.innerHTML = '';
  options.forEach(opt => { 
    const el = document.createElement('option'); el.value = opt; el.text = opt; sel.appendChild(el);
  });
}
function manageDropdown(key, selectId){
  let options = JSON.parse(localStorage.getItem('options_' + key));
  let newVal = prompt(`Current options: ${options.join(',')}\nAdd/Remove (comma separated)`, options.join(','));
  if(newVal!==null){
    options = newVal.split(',').map(s=>s.trim()).filter(s=>s);
    localStorage.setItem('options_'+key, JSON.stringify(options));
    loadDropdownOptions(key, selectId);
  }
}

// Farm info
function saveFarmInfo(){
  const info = {
    name: document.getElementById('farmName').value,
    address: document.getElementById('farmAddress').value,
    phone: document.getElementById('farmPhone').value
  };
  localStorage.setItem('farmInfo', JSON.stringify(info));
}
function loadFarmInfo(){
  const info = JSON.parse(localStorage.getItem('farmInfo')||'{}');
  document.getElementById('farmName').value = info.name || '';
  document.getElementById('farmAddress').value = info.address || '';
  document.getElementById('farmPhone').value = info.phone || '';
}

// Animals
function getAnimals(){ return JSON.parse(localStorage.getItem('animals')||'[]'); }
function saveAnimals(data){ localStorage.setItem('animals', JSON.stringify(data)); }

function saveAnimal(){
  const tag = document.getElementById('animalTag').value.trim();
  if(!tag){ alert('Tag number is required'); return; }
  const tattoo = document.getElementById('animalTattoo').value.trim();
  const animal = {
    tag, tattoo,
    breed: document.getElementById('animalBreed').value,
    type: document.getElementById('animalType').value,
    location: document.getElementById('animalLocation').value,
    maternal: document.getElementById('maternalParent').value,
    paternal: document.getElementById('paternalParent').value,
    udderSuspension: document.getElementById('udderSuspension').value,
    udderSize: document.getElementById('udderSize').value,
    calvingEase: document.getElementById('calvingEase').value,
    docility: document.getElementById('docility').value,
    medications: currentMedications
  };
  let animals = getAnimals();
  const existing = animals.find(a => a.tag === tag && a.breed === animal.breed);
  if(existing){
    if(!confirm('Animal exists. Update?')) return;
    animals = animals.filter(a => !(a.tag === tag && a.breed === animal.breed));
  }
  animals.push(animal);
  saveAnimals(animals);
  loadAnimals();
  currentMedications = [];
  document.getElementById('medHistory').innerHTML = '';
}

function loadAnimals(){
  const animals = getAnimals();
  const tbody = document.querySelector('#animalsTable tbody');
  tbody.innerHTML = '';
  animals.forEach(a => {
    const row = tbody.insertRow();
    row.insertCell().innerText = a.tag;
    row.insertCell().innerText = a.tattoo;
    row.insertCell().innerText = a.breed;
    row.insertCell().innerText = a.type;
    row.insertCell().innerText = a.location;
    row.insertCell().innerText = a.maternal;
    row.insertCell().innerText = a.paternal;
    row.insertCell().innerText = a.udderSuspension;
    row.insertCell().innerText = a.udderSize;
    row.insertCell().innerText = a.calvingEase;
    row.insertCell().innerText = a.docility;
    row.insertCell().innerText = a.medications.map(m=>`${m.date} ${m.type}`).join('; ');
  });
}

// Medications
function addMedication(){
  const med = {
    date: document.getElementById('medDate').value,
    type: document.getElementById('medType').value,
    qty: document.getElementById('medQty').value,
    next: document.getElementById('medNext').value
  };
  currentMedications.push(med);
  const li = document.createElement('li');
  li.innerText = `${med.date} - ${med.type} (${med.qty}) Next: ${med.next}`;
  document.getElementById('medHistory').appendChild(li);
}

// Export / Import
function exportData(){
  const data = {
    farm: JSON.parse(localStorage.getItem('farmInfo')||'{}'),
    animals: getAnimals()
  };
  const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'farm_data.json';
  a.click();
}

function importData(input){
  const file = input.files[0];
  const reader = new FileReader();
  reader.onload = function(e){
    try {
      const imported = JSON.parse(e.target.result);
      if(imported.farm){
        const currentFarm = JSON.parse(localStorage.getItem('farmInfo')||'{}');
        if(JSON.stringify(currentFarm) !== JSON.stringify(imported.farm)){
          if(confirm(`Farm info differs, update?`)) {
            localStorage.setItem('farmInfo', JSON.stringify(imported.farm));
            loadFarmInfo();
          }
        }
      }
      let currentAnimals = getAnimals();
      imported.animals.forEach(impAnimal => {
        const existing = currentAnimals.find(a => a.tag === impAnimal.tag && a.breed === impAnimal.breed);
        if(existing){
          if(confirm(`Animal with Tag ${impAnimal.tag} and Breed ${impAnimal.breed} exists. Update?`)){
            currentAnimals = currentAnimals.filter(a => a !== existing);
            currentAnimals.push(impAnimal);
          }
        } else {
          currentAnimals.push(impAnimal);
        }
      });
      localStorage.setItem('animals', JSON.stringify(currentAnimals));
      loadAnimals();
      alert('Import completed.');
    } catch(err){
      alert('Error importing file: '+err);
    }
  };
  reader.readAsText(file);
}

document.addEventListener('DOMContentLoaded', () => {
  loadDropdownOptions('breed','animalBreed');
  loadDropdownOptions('udderSuspension','udderSuspension');
  loadDropdownOptions('udderSize','udderSize');
  loadDropdownOptions('calvingEase','calvingEase');
  loadDropdownOptions('docility','docility');
  loadFarmInfo();
  loadAnimals();
});
</script>
</body>
</html>